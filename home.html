<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>NISSE Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body>
    <div class="container">
        <!-- Navbar -->
        <ul class="nav">
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#accountModal" href="#">Account</a>
            </li>
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" id="logoutSubmit" href="#">Logout</a>
            </li>
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" href="#">Enter Foods</a>
            </li>
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#loginModal" href="#">Login</a>
            </li>
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#signUpModal" href="#">Signup</a>
            </li>
        </ul>

        <!-- Sign Up Modal -->
        <div class="modal" id="signUpModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Sign up</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Sign up for a new NISSE account.</p>
                    </div>
                    <form>
                        <div class="form-group" id="signup-form">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="signup-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                            <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                                else.</small>
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="signup-password"
                                placeholder="Choose password">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="signupSubmit">Sign Up</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log In Modal -->
        <div class="modal" id="loginModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Log In</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Log in to your NISSE account.</p>
                    </div>
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="login-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="login-password"
                                placeholder="Enter password">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="loginSubmit">Login</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Modal -->
        <div class="modal" id="accountModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Account Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4>NISSE Account</h4>
                        <div class="accountDetails"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="card border-dark mb-3">
                    <div class="card-body text-dark">
                        <h5 class="card-title">API Testing</h5>
                        <p class="card-text">Test view for searching food database:</p>
                        <p class="card-text">
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6" id="genArea">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Search</h5>
                        <p class="card-text">Enter search below.</p>
                        <!-- Term or upc code indicator -->
                        <div class="btn-group btn-group-toggle" data-toggle="buttons">
                            <label class="btnUPC btn btn-primary active">
                                <input type="radio" name="options" id="option1" autocomplete="off" checked>UPC
                            </label>
                            <label class="btnTerm btn btn-primary">
                                <input type="radio" name="options" id="option2" autocomplete="off">Term
                            </label>
                        </div>
                        <!-- Search term entry box -->
                        <div class="input-group" id="contentInput">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Content (required)</span>
                            </div>
                            <textarea id="content" class="form-control" aria-label="textInput"></textarea>
                        </div>
                        <a href="#" id="contentSubmit" class="btn btn-primary">Search</a>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Result</h5>
                        <p class="card-text">View results.</p>
                        <div id="apiResult"></div>
                        <a href="#" id="upcScanSubmit" class="btn btn-primary">Save UPC Search</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-firestore.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyCKI5yVJ5kHZdRXhkoG9TT4UhvkVUaLm5Y",
                authDomain: "nisse-ed27f.firebaseapp.com",
                databaseURL: "https://nisse-ed27f.firebaseio.com",
                projectId: "nisse-ed27f",
                storageBucket: "nisse-ed27f.appspot.com",
                messagingSenderId: "928216397567",
                appId: "1:928216397567:web:36c0d0c289d57b23637eca"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);

            // make auth and firestore references
            const auth = firebase.auth();
            const db = firebase.firestore();
        </script>

        <!-- jQuery (not sure both are needed; may need to clean up later)         -->
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
        </script>
        <script src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

        <!-- Compiled and minified JavaScript -->
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> -->
        <script src="assets/javascript/auth.js"></script>
        <script src="assets/javascript/home.js"></script>

        <!-- Bootstrap -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
        </script>

        <!-- API call; may need to clean up by moving to its own file later -->
        <script type="text/javascript">
            // Execute on button click
            $('#contentSubmit').click(function () {
                var itemSearch = escape($("#content").val());
                var queryURL = "";
                if ($('.btnUPC').hasClass('active')) {
                    queryURL =
                        "https://api.edamam.com/api/food-database/parser?app_id=bf8ea370&app_key=7e63897a099fbb487636c3a7c1cdabce&upc=" +
                        itemSearch;
                } else {
                    queryURL =
                        "https://api.edamam.com/api/nutrition-data?app_id=bf8ea370&app_key=7e63897a099fbb487636c3a7c1cdabce&ingr=" +
                        itemSearch;
                }

                // Perform an AJAX request with the queryURL
                $.ajax({
                        url: queryURL,
                        method: "GET"
                    })
                    // After data comes back from the request
                    .then(function (response) {


                        if ($('.btnUPC').hasClass('active')) {
                            // Create a div to hold the info
                            var upcCode = $("<pre>");
                            upcCode.attr('id', 'upcCode');
                            var label = $("<pre>");
                            label.attr('id', 'upcLabel');
                            var brand = $("<pre>");
                            brand.attr('id', 'upcBrand');
                            var category = $("<pre>");
                            category.attr('id', 'upcCategory');

                            var contents = $("<p>");

                            // Set a string variable to capture the response text
                            var str = response;
                            console.log(str);
                            var upcData = response.text;
                            var labelData = response.hints[0].food.label;
                            var brandData = response.hints[0].food.brand;
                            var categoryData = response.hints[0].food.category;
                            var fatData = response.hints[0].food.nutrients.fat;
                            var apiFat = JSON.stringify(fatData, null, " ");
                            var apiFoodContentsLabel = response.hints[0].food.foodContentsLabel;
                            var apiImage = response.hints[0].food.image;

                            // Insert the info
                            upcCode.html(upcData.replace("upc:", ""));
                            label.html(labelData);
                            brand.html(brandData);
                            category.html(categoryData);

                            contents.html(apiFoodContentsLabel);

                            // Append the result(s) to the image div
                            $("#apiResult").append(upcCode);
                            $("#apiResult").append(label);
                            $("#apiResult").append(brand);
                            $("#apiResult").append(category);
                            $("#apiResult").append(contents);
                        } else {
                            // Create a div to hold the info
                            var dietInfo = $("<pre>");
                            var healthInfo = $("<pre>");

                            // Set a string variable to capture the response text
                            var str = response;
                            console.log(str);
                            // var dietLabelData = [];
                            var dietData = response.dietLabels;
                            var dietLabelData = JSON.stringify(dietData, null, " ");
                            var healthData = response.healthLabels;
                            var healthLabelData = JSON.stringify(healthData, null, " ");
                            // console.log(response.dietLabels);
                            // console.log(response.dietLabels.length);
                            // for (var i=0; i < response.dietLabels.length; i++) {
                            //     dietLabelData.push(response.dietLabels[i]);
                            //     console.log(dietLabelData);
                            // }

                            // var healthLabelData = [];
                            console.log(healthLabelData);
                            //   response.healthLabels);
                            // console.log(response.healthLabels.length);
                            // for (var i=0; i < response.healthLabels.length; i++) {
                            //     healthLabelData.push(response.healthLabels[i]);
                            //     console.log(healthLabelData);
                            // }

                            // Insert the info
                            dietInfo.html(dietLabelData);
                            healthInfo.html(healthLabelData);

                            // Append the result(s) to the image div
                            $("#apiResult").append(dietInfo);
                            $("#apiResult").append(healthInfo);
                        }
                    });
            });
        </script>
</body>

</html>