<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>NISSE Home</title>
    <!-- Edamam attribution -->
    <script src="https://developer.edamam.com/attribution/badge.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body>
    <div class="container">
        <!-- Navbar -->
        <ul class="nav">
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#accountModal" href="#">Account</a>
            </li>
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" id="logoutSubmit" href="#">Logout</a>
            </li>
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" href="#">Enter Foods</a>
            </li>
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#loginModal" href="#">Login</a>
            </li>
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#signUpModal" href="#">Signup</a>
            </li>
        </ul>

        <!-- Sign Up Modal -->
        <div class="modal" id="signUpModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Sign up</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Sign up for a new NISSE account.</p>
                    </div>
                    <form>
                        <div class="form-group" id="signup-form">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="signup-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                            <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                                else.</small>
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="signup-password"
                                placeholder="Choose password">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="signupSubmit">Sign Up</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log In Modal -->
        <div class="modal" id="loginModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Log In</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Log in to your NISSE account.</p>
                    </div>
                    <form>
                        <div class="form-group">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="login-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="login-password"
                                placeholder="Enter password">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="loginSubmit">Login</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Modal -->
        <div class="modal" id="accountModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Account Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4>NISSE Account</h4>
                        <div class="accountDetails"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-12">
                <div class="card border-dark mb-3">
                    <div class="card-body text-dark">
                        <h5 class="card-title">API Testing</h5>
                        <p class="card-text">Test view for searching food database:</p>
                        <p class="card-text">
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6" id="genArea">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Search</h5>
                        <p class="card-text">Enter UPC Code or search terms below.</p>
                        <!-- Search term entry box -->
                        <div class="input-group" id="contentInput">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Content (required)</span>
                            </div>
                            <textarea id="content" class="form-control" aria-label="textInput"></textarea>
                        </div>
                        <a href="#" id="contentSubmit" class="btn btn-primary">Search</a>
                        <div id="edamam-badge" data-color="white"></div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Result</h5>
                        <p class="card-text">View results.</p>
                        <div id="apiResult">
                            <div id="userEmailLabel">Logged in user: </div>
                            <div id="userEmail"></div>
                            <br>
                            <div id="apiUPCTermLabel">UPC / Term: </div>
                            <pre id="apiUPCTerm"></pre>
                            <div id="apiLabelLabel">Label: </div>
                            <pre id="apiLabel"></pre>
                            <div id="apiBrandlabel">Brand: </div>
                            <pre id="apiBrand"></pre>
                            <div id="apiCategoryLabel">Category: </div>
                            <pre id="apiCategory"></pre>
                            <div id="apiContentsLabel">Contents: </div>
                            <pre id="apiContents"></pre>
                            <div id="timeStamp"></div>
                        </div>
                        <br>
                        <a href="#" id="searchSubmit" class="btn btn-primary">Save Search</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-firestore.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCKI5yVJ5kHZdRXhkoG9TT4UhvkVUaLm5Y",
            authDomain: "nisse-ed27f.firebaseapp.com",
            databaseURL: "https://nisse-ed27f.firebaseio.com",
            projectId: "nisse-ed27f",
            storageBucket: "nisse-ed27f.appspot.com",
            messagingSenderId: "928216397567",
            appId: "1:928216397567:web:36c0d0c289d57b23637eca"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // make auth and firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <!-- jQuery (not sure both are needed; may need to clean up later)         -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

    <!-- Compiled and minified JavaScript -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script> -->
    <script src="assets/javascript/auth.js"></script>
    <script src="assets/javascript/home.js"></script>

    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>

    <!-- API call; may need to clean up by moving to its own file later -->
    <script type="text/javascript">
        // Execute on button click
        $('#contentSubmit').click(function () {
            // clear any previous search result content
            $('userEmail').html('');
            $('#apiUPCTerm').html('');
            $('#apiLabel').html('');
            $('#apiBrand').html('');
            $('#apiCategory').html('');
            $('#apiContents').html('');
            $('#timeStamp').html('');
            // url encode the form field per Edamam API recommendation
            var itemSearch = escape($("#content").val());
            // set a variable for the GET query url to the API
            var queryURL = "";
            // set a variable for the response array number (temp fix for term search to grab the second item from the array)
            var respArrayNum = 0;
            // set a variable to calculate the current time
            var dt = new Date();
            // convert the date format to eastern US time zone
            var estDate = dt.toLocaleString("en-US", {
                timeZone: "America/New_York"
            });

            // if the first character is a number treat as a UPC code, else treat as a term...
            if (!isNaN(itemSearch.charAt(0))) {
                console.log(itemSearch.charAt(0) + " this should be a number!");
                queryURL =
                    "https://api.edamam.com/api/food-database/parser?app_id=a3ff7089&app_key=41e4887a97f837312663c573bc186cbb&upc=" +
                    itemSearch;
            } else {
                console.log(itemSearch + " " + itemSearch.charAt(0) + " this should be a letter!");
                queryURL =
                    "https://api.edamam.com/api/food-database/parser?nutrition-type=logging&category=packaged-foods&categoryLabel=food&ingr=" +
                    itemSearch + "&app_id=a3ff7089&app_key=41e4887a97f837312663c573bc186cbb"
                respArrayNum = 1;
            }

            // Perform an AJAX request with the queryURL
            $.ajax({
                    url: queryURL,
                    method: "GET"
                })
                // After data comes back from the request
                .then(function (response) {

                    // Create a div to hold the info
                    var code = $('#apiUPCTerm');
                    var label = $('#apiLabel');
                    var brand = $('#apiBrand');
                    var category = $('#apiCategory');
                    var contents = $('#apiContents');

                    // Set a string variable to capture the response text
                    var str = response;
                    console.log(str);
                    var codeData = response.text;
                    var labelData = response.hints[respArrayNum].food.label;
                    var brandData = response.hints[respArrayNum].food.brand;
                    var categoryData = response.hints[respArrayNum].food.category;
                    var fatData = response.hints[respArrayNum].food.nutrients.fat;
                    var apiFat = JSON.stringify(fatData, null, " ");
                    var apiFoodContentsLabel = response.hints[respArrayNum].food.foodContentsLabel;
                    var apiImage = response.hints[respArrayNum].food.image;

                    // Insert the info
                    code.html(codeData.replace("upc:", ""));
                    label.html(labelData);
                    brand.html(brandData);
                    category.html(categoryData);
                    contents.html(apiFoodContentsLabel);
                    $('#timeStamp').html(estDate);
                });
        });
    </script>
</body>

</html>