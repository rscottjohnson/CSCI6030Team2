<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NISSE Home</title>
    <!-- Edamam attribution -->
    <script src="https://developer.edamam.com/attribution/badge.js"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css" />
</head>

<body>
    <div class="container-fluid">
        <!-- Navbar -->
        <ul class="nav">
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#accountModal" href="#">Account</a>
            </li>
            <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" id="logoutSubmit" href="#">Logout</a>
            </li>
            <!-- <li class="nav-item logged-in" style="display:none">
                <a class="nav-link" href="#">Enter Foods</a>
            </li> -->
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#loginModal" href="#">Login</a>
            </li>
            <li class="nav-item logged-out" style="display:none">
                <a class="nav-link" data-toggle="modal" data-target="#signUpModal" href="#">Signup</a>
            </li>
        </ul>

        <div class="jumbotron jumbotron-fluid jumbotron-custom">
            <h1 class="display-4">Welcome to NISSE!</h1>
            <p class="lead">NISSE is the Nutritional Ingredient Scanner/Search Engine</p>
            <hr class="my-4">
            <!-- <p id="instrText">Enter a food UPC Code or search term below to get started. To scan a UPC Code, hit the
                Scan Start / Stop button below and align a UPC Code in the scanner window.</p> -->
            <!-- <p class="lead">
                <div class="input-group" id="contentInput">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Input (required)</span>
                    </div>
                    <textarea id="content" class="form-control" aria-label="textInput"></textarea>
                </div>
                <a href="#" id="btn" class="btn btn-primary">Scan Start / Stop</a>
                <a href="#" id="contentSubmit" class="btn btn-success">Search</a>
                <div id="edamam-badge" data-color="white"></div>
            </p> -->
        </div>

        <!-- Search bar -->
        <div class="row">
            <div class="col-md-6">
                <form>
                    <div class="form-group">
                        <!-- <h4 id="instrText1">Enter a food UPC Code or search term below to get started.</h4> -->
                        <!-- <h5 id="instrText2">To scan a UPC Code, hit the Scan Start / Stop button below and align a UPC Code in the scanner window.</h5> -->
                        <label for="FormControlInput1">Enter a food UPC Code or search term below to get started. To
                            scan a UPC Code, hit the Scan Start / Stop button below and align a UPC Code in the scanner
                            window.</label>
                        <input type="text" class="form-control" id="content"
                            placeholder="example: 044000030377 or nabisco wheat thins">
                    </div>
                    <a href="#" id="btn" class="btn btn-primary">Scan Start / Stop</a>
                    <a href="#" id="contentSubmit" class="btn btn-success">Search</a>
                    <div id="edamam-badge" data-color="white"></div>
                </form>
            </div>
            <!-- Scanner -->
            <div class="col-md-6" id="scanner-container"></div>
        </div>


        <!-- Sign Up Modal -->
        <div class="modal" id="signUpModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Sign up</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Sign up for a new NISSE account.</p>
                    </div>
                    <form id="signUpForm">
                        <div class="form-group" id="signup-form">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="signup-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                            <small id="emailHelp" class="form-text text-muted">We'll never share your email with
                                anyone
                                else.</small>
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="signup-password"
                                placeholder="Choose password">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" id="signupSubmit">Sign Up</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log In Modal -->
        <div class="modal" id="loginModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Log In</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Log in to your NISSE account.</p>
                    </div>
                    <form id="logInForm">
                        <div class="form-group">
                            <label for="exampleInputEmail1">Email address</label>
                            <input type="email" class="form-control" id="login-email" aria-describedby="emailHelp"
                                placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword1">Password</label>
                            <input type="password" class="form-control" id="login-password"
                                placeholder="Enter password">
                            <p class="loginError"></p>
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="loginSubmit">Login</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Modal -->
        <div class="modal" id="accountModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Account Details</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4>NISSE Account</h4>
                        <div class="accountDetails"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Result</h5>
                        <p class="card-text">View results.</p>
                        <hr class="logged-in">
                        <div id="apiResult">
                            <!-- card column 1 -->
                            <div class="row">
                                <div class="col-sm-6">
                                    <div id="userEmailLabel">Logged in user: </div>
                                    <div id="userEmail"></div>
                                    <br>
                                    <div id="apiUPCTermLabel">UPC / Term: </div>
                                    <pre id="apiUPCTerm"></pre>
                                    <div id="apiLabelLabel">Label: </div>
                                    <pre id="apiLabel"></pre>
                                    <div id="apiBrandlabel">Brand: </div>
                                    <pre id="apiBrand"></pre>
                                    <div id="apiCategoryLabel">Category: </div>
                                    <pre id="apiCategory"></pre>
                                    <div id="apiContentsLabel">Contents: </div>
                                    <pre id="apiContents"></pre>
                                    <div id="timeStamp"></div>
                                </div>
                                <div class="col-sm-6">
                                    <!-- Dropdown button for relevancy -->
                                    <div class="relevancyDropdown logged-in">
                                        <h6 id="dropdownLabel">These results are (neutral, relevant, or
                                            nonrelevant):
                                        </h6>
                                        <select class="bootstrap-select" id="relevancyDD">
                                            <option value="1" selected="selected">Neutral</option>
                                            <option value="2">Relevant</option>
                                            <option value="3">Nonrelevant</option>
                                        </select>
                                    </div>
                                    <br>
                                    <div class="severityDropdown logged-in">
                                        <h6 id="dropdownLabel">Reaction Severity (select if any):</h6>
                                        <select class="bootstrap-select" id="severityDD">
                                            <option value="1" selected="selected">None</option>
                                            <option value="2">Mild</option>
                                            <option value="3">Moderate</option>
                                            <option value="4">Severe</option>
                                        </select>
                                    </div>
                                    <br>
                                    <div Comment area for user free text feedback -->
                                        <div class="input-group commentBox logged-in">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text">Comments (optional)</span>
                                            </div>
                                            <textarea class="form-control" id="commentText"
                                                aria-label="With textarea"></textarea>
                                        </div>
                                    </div>
                                    <br>
                                    <a href="#" id="searchSubmit" class="btn btn-primary logged-in">Save Search</a>
                                </div>
                            </div>
                            <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end of container -->
    <footer class="footer">
        <div class="container">
            <div id="footer">
                <br />
                <p>The Nutritional Ingredient Scanner/Search Engine is the combined work of:</p>
                <p><a href="https://github.com/KelleClark">Kelle Clark</a>, <a href="https://github.com/cgembs">Caroline
                        Gembs</a>, <a href="https://github.com/rscottjohnson">Scott Johnson</a>, Sara Khanjari,
                    <a href="https://github.com/phmaa">Phoebe Maa</a>, and <a
                        href="https://github.com/Jared-Mello">Jared Mello</a></p>
                <p>NISSE &copy; 2020</p>
                <p>Header photo by <a
                        href="https://unsplash.com/@joannakosinska?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Joanna
                        Kosinska</a> on <a
                        href="https://unsplash.com/s/photos/food?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.1/firebase-firestore.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use -->
    <!-- https://firebase.google.com/docs/web/setup#available-libraries -->

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyCKI5yVJ5kHZdRXhkoG9TT4UhvkVUaLm5Y",
            authDomain: "nisse-ed27f.firebaseapp.com",
            databaseURL: "https://nisse-ed27f.firebaseio.com",
            projectId: "nisse-ed27f",
            storageBucket: "nisse-ed27f.appspot.com",
            messagingSenderId: "928216397567",
            appId: "1:928216397567:web:36c0d0c289d57b23637eca"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // make auth and firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <!-- Bootstrap and jQuery (keep both jQuery scripts included)-->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
    <!-- QuaggaJS scanner library -->
    <script type="text/javascript" src="assets/javascript/libraries/serratus-quaggaJS-862df88/dist/quagga.min.js">
    </script>

    <!-- Compiled and minified JavaScript -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></!-->
    <script src="assets/javascript/auth.js"></script>
    <script src="assets/javascript/home.js"></script>
    <script src="assets/javascript/scan.js"></script>

    <!-- API call; may need to clean up by moving to its own file later -->
    <script type="text/javascript">
        // Execute on button click
        $('#contentSubmit').click(function () {
            // clear any previous search result content
            $('userEmail').html('');
            $('#apiUPCTerm').html('');
            $('#apiLabel').html('');
            $('#apiBrand').html('');
            $('#apiCategory').html('');
            $('#apiContents').html('');
            $('#timeStamp').html('');
            // url encode the form field per Edamam API recommendation
            var itemSearch = escape($("#content").val());
            // set a variable for the GET query url to the API
            var queryURL = "";
            // set a variable for the response array number (temp fix for term search to grab the second item from the array)
            var respArrayNum = 0;
            // set a variable to calculate the current time
            var dt = new Date();
            // convert the date format to eastern US time zone
            var estDate = dt.toLocaleString("en-US", {
                timeZone: "America/New_York"
            });

            // if the first character is a number treat as a UPC code, else treat as a term...
            if (!isNaN(itemSearch.charAt(0))) {
                console.log(itemSearch.charAt(0) + " this should be a number!");
                queryURL =
                    "https://api.edamam.com/api/food-database/parser?app_id=a3ff7089&app_key=41e4887a97f837312663c573bc186cbb&upc=" +
                    itemSearch;
            } else {
                console.log(itemSearch + " " + itemSearch.charAt(0) + " this should be a letter!");
                queryURL =
                    "https://api.edamam.com/api/food-database/parser?nutrition-type=logging&category=packaged-foods&categoryLabel=food&ingr=" +
                    itemSearch + "&app_id=a3ff7089&app_key=41e4887a97f837312663c573bc186cbb"
                respArrayNum = 1;
            }

            // Perform an AJAX request with the queryURL
            $.ajax({
                    url: queryURL,
                    method: "GET"
                })
                // After data comes back from the request
                .then(function (response) {

                    // Create a div to hold the info
                    var code = $('#apiUPCTerm');
                    var label = $('#apiLabel');
                    var brand = $('#apiBrand');
                    var category = $('#apiCategory');
                    var contents = $('#apiContents');

                    // Set a string variable to capture the response text
                    var str = response;
                    console.log(str);
                    var codeData = response.text;
                    var labelData = response.hints[respArrayNum].food.label;
                    var brandData = response.hints[respArrayNum].food.brand;
                    var categoryData = response.hints[respArrayNum].food.category;
                    var fatData = response.hints[respArrayNum].food.nutrients.fat;
                    var apiFat = JSON.stringify(fatData, null, " ");
                    var apiFoodContentsLabel = response.hints[respArrayNum].food.foodContentsLabel;
                    var apiImage = response.hints[respArrayNum].food.image;

                    // Insert the info
                    code.html(codeData.replace("upc:", ""));
                    label.html(labelData);
                    brand.html(brandData);
                    category.html(categoryData);
                    contents.html(apiFoodContentsLabel);
                    $('#timeStamp').html(estDate);
                });
        });
    </script>
</body>

</html>